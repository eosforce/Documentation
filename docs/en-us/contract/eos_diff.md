# Contract Development

## Contract Compiling and Loading Process

```shell
account='Your Contract account'
eosiocpp=./build/tools/eosiocpp #eosiocpp tool path，could be generated by compiling eosforce project
contract_path='Your Contract source path'

# Compiling
$eosiocpp -g contract.abi $contract_path/contract.hpp
$eosiocpp -o contract.wasm $contract_path/contract.cpp

# Loading
leos wallet unlock --password '钱包密码'
cleos -u https://w1.eosforce.cn set abi $account contract.abi
cleos -u https://w1.eosforce.cn set code $account contract.wasm
```

## Difference from EMLG EOS，and Contract Migrations Notes

### 1. transfer

The contract receiver is 'eosio', not 'eosio.token', when listening on EOSC transfer messages，or EOSC inline transfer in contract。 
because EOS force's EOSC transfer action is in system contract , not in eosio.token contract。token transfer's logic will not change。

eg：inline transfer in contract

```c++
action(permission_level{_self, N(active)}, N(eosio), N(transfer),std::make_tuple(_self, to, quantity, std::string("")))
        .send();
```

Note：When inline transfering in contract，contract account's active permission needs to be granted to eosio.code account.

```shell
account='Your Contract account'
PK='Contract account public key'
cleos set account permission $account active '{"threshold": 1,"keys": [{"key":"'$PK'", "weight":1}],"accounts": [{"permission":{"actor":"'$account'","permission":"eosio.code"},"weight":1}]}' owner -p $account'@owner'
```

### 2. fees

First，please refer to [resource model introduction document](https://eosforce.github.io/Documentation/#/zh-cn/res_limit) 。

Fee needs to be set for every action in EOS force，if fee is not set for an action，the following errors will occur：

```shell
error 2019-01-11T07:23:20.785 thread-0  http_plugin.cpp:580           handle_exception     ] FC Exception encountered while processing chain.push_transaction
debug 2019-01-11T07:23:20.785 thread-0  http_plugin.cpp:581           handle_exception     ] Exception Details: 3050000 action_validate_exception: Action validate exception
action testd hi name not include in feemap or db
    {"acc":"testd","act":"hi"}
    thread-0  txfee_manager.cpp:76 get_required_fee

```

This is an example callng `hi`action deplyed in `testd`account，the node accepting the transaction will print detailed information。

In Eosforce，we require the user to pay the fees for every action executed，this is similar with ETH。 Paid fees provide CPU and NET resource limit for the action， Fixed fees and limits are employed for native actions such as transfer、newaccount、updateauth for user convennience, 对于用户定义的action，其中的换算比例是由BP通过多签来设置的，在默认情况下，每支付0.01 EOSC，该action会被赋予 200 us cpu使用限制和 500 byte net使用限制，为了便于用户使用，开发者需要为自己提交的合约中action设置手续费额度，这样用户则不需自行设置手续费额度，同时也激励开发者优化合约资源使用效率，为用户提供更好的体验。

DApp developpers need to evaluate how much resource contract actions could consume and then set fees for contract actions：

use setfee：

```shell
./cleos set setfee testd hi "0.0500 EOS" 0 0 0
debug 2019-01-11T07:27:14.427 thread-0  main.cpp:2465                 operator()           ] set fee hi, 0.0500 SYS
executed transaction: 247de68c2815eec4fa46b1356bd6bec247a43aa2c22f68c6cc976cf6accc9a4d  136 bytes  250 us
#         eosio <= eosio::setfee                "000000008094b1ca000000000000806bf4010000000000000453595300000000000000000000000000000000"
#   eosio.token <= eosio.token::fee             {"payer":"testd","quantity":"0.1000 EOS"}
warning: transaction executed locally, but may not be confirmed by the network yet         ] 
```

Fees for testd::hi action was set 0.05 EOS in this example， noting the last three zeros。

Note: Setting fees need contract account permission.

setfee usage：

```
Usage: ./cleos set setfee [OPTIONS] account action fee cpu_limit net_limit ram_limit

Positionals:
  account TEXT                The account to set the Fee for (required)
  action TEXT                 The action to set the Fee for (required)
  fee TEXT                    The Fee to set to action (required)
  cpu_limit UINT              The cpu max use limit to set to action (required)
  net_limit UINT              The net max use limit to set to action (required)
  ram_limit UINT              The ram max use limit to set to action (required)
```

Among those

- account: contract account name
- action: contract action name fees set for
- fee: fee ammount，only accepting eos
- cpu_limit: used CPU resource upper limit when contract action was executed，unit us，0 for user contract action
- net_limit: used NET resource upper limit when contract action was executed，unit us，0 for user contract action
- ram_limit: used RAM resource upper limit when contract action was executed，unit us，0 for user contract action

Developpers need to execute set code 、set abi to load the contract.

You could join 'Force Mainnet DAPP developpers grroup' wechat group for detailed messages.

### 3. Block production speed

please note that force produce a block every 3 seconds, for time-depending contract.

### 4. Delayed transactions not open

Tentatve open for next Mainnet upgrade.
