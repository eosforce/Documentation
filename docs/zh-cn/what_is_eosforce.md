# EOSForce介绍

<!-- vim-markdown-toc GFM -->

* [背景](#背景)
* [共识机制](#共识机制)
* [EOSC技术改进](#经EOSC技术改进)
    * [基于手续费的资源模型](#基于手续费的资源模型)
    * [平滑的更新机制](#平滑的更新机制)
    * [节点心跳机制与稳定的出块间隔](#节点心跳机制与稳定的出块间隔)
    * [更多的合约层API](#更多的合约层API)
    * [适配跨链服务](#适配跨链服务)
    * [高度可定制化的EOSIO区块链开发框架](#高度可定制化的EOSIO区块链开发框架)
* [社区治理](#社区治理)
    * [投票分红](#投票分红)
    * [一票一投](#一票一投)
    * [23 个超级节点](#23-个超级节点)
    * [紧急状态](#紧急状态)

<!-- vim-markdown-toc -->

[English Version](README_en.md)

## 背景

加密经济迎来了从社会试验走向大规模商用的关键阶段。

大规模商用的背后意味着庞大的交易压力。一个区块链系统要高效地承载起巨量的交易需求，首先必须提供足够强劲的性能。要实现这一点，就需要对全节点提出更高的要求，如配置更好的硬件机器、更大的存储容量、更加稳定的网络、更快的带宽、更低的时延，等等。显然，全节点门槛过高会导致能稳定运行的出块节点数量减少，如果在这样的区块链系统中采用POS机制，系统将迅速收敛至中心化的局面。要在高性能和去中心化之间取得平衡，DPOS共识算法无疑是当前最佳的选择，也是针对管理少量节点可行的最好的解决方案。

基于DPOS共识算法的EOSIO应运而生，社区第一次看到了加密经济大规模商用的曙光。选举机制是否充分生效是DPOS共识机制存亡的关键，也关系到DPOS共识机制能否接力POW引领下一代加密浪潮。

为了加速加密经济大规模商用时代的到来，EOSC社区对EOSIO的选举机制进行了优化，在创世高度1启动了EOSC主网，并持续对EOSC主网进行迭代升级，使得EOSC朝着去中心化的高性能智能合约平台的方向持续演进。

## 共识机制

EOSC沿用了EOSIO的共识机制, 即DPOS BFT Pipeline Consensus, 与EOSIO不同, EOSC没有采用EOSIO每0.5秒一个区块, 一个节点连出6个块的模式, EOSC中每3秒一个区块, 节点不会连续出块, 虽然节点连续出块可以降低未打包交易的等待时间, 但是由于当前网络环境往往并不十分理想, 快速出块会影响链的稳定, 造成大量的微分叉.

EOSIO当前的共识机制不够完美, 但是作为一个DAPP的平台, 区块的确认时间并不是链的第一优化要务, 对于EOSC, 必须在高负载环境下考虑共识机制, 在当前并行计算机制并不完善的情况下, 仓促改进流水线式的确认机制很带来很大问题.

EOSC未来的共识机制将会从两个方向并行演进 
1.兼容EOSIO发展更新其共识算法,我们根据EOSIO当前开发进度判断，当EOSIO完成并行改进之后, 将会升级共识算法, 实现更快的区块确认时间. 
2.将会适配其他的基于确认数的共识机制, 作为现有DPOS共识的补充, 一方面实现内嵌的Layer 2链共识与主链的交互。另一方面, 可以实现与其他共识机制的链完成更加去中心化的跨链机制.

## EOSC技术改进

### 基于手续费的资源模型

EOSIO的CPU和NET资源的支付模式虽然在技术是一个很好的设计, 对于用户来说太过复杂, 同时不能促进DAPP开发者优化其合约, 另一方面, EOSIO的RAM的购买方式会导致某些囤积行为, 不利于DAPP生态的发展, 为此, EOSC创新的设计了一套全新的资源模型, 通过实践中的优化,探索在复杂智能合约环境下基于手续费的资源模型, 彻底解决困扰EOS生态的资源问题.

首先, EOSC以手续费模式支付用户的CPU和NET资源消耗, 对于DAPP当中开发者定义的Action, DAPP开发者可以为Action设置所需的手续费, 系统基于此来控制Action的资源使用, 这样一方面便于用户理解资源的消耗, 另一方面也强烈的促进DAPP开发者优化合约资源使用, 使得整个生态良性发展.

EOSC采用类似租云主机的方式以方式分配RAM资源, 用户可以通过使用投票分红来支付租赁RAM资源的费用, 这样即不需要用户担忧租金缴纳问题, 也杜绝了租金欠费的问题. 通过“以租代售”的方式, EOSC可以有效避免针对RAM资源的投机行为, 使得DAPP的发展不必受到RAM价格的干扰, 有效促进DAPP生态建设.

在大胆创新探索新的资源模型的同时, EOSC也在机制上进行探索以兼容EOSIO的资源模型, 对于CPU和NET资源, 用户可以基于分红票龄支付手续费来达到类似EOSIO抵押获取CPU和NET资源的效果, 对于RAM, 用户可以通过抵押投票互换的形式来达到EOSIO基于市场购买的效果, 这样DAPP开发者可以快速从其他EOSIO链切入EOSC, 并平滑的转向EOSC的资源模式.

### 平滑的更新机制

EOSC的选举机制促使超级节点积极的参与推进技术升级, 不同于EOSIO社区节点版本的分裂, EOSC在实践中积极的推进技术升级和更新.

为了实现更平滑的不兼容升级过程, EOSC添加了一套基于生效区块高度的更新机制, 社区可以通过多签确认一个功能的生效块高度, 以此去中心化的完成平滑的升级过程, 不同于EOSIO最近提出的基于区块拓展数据的标签方案, EOSC的更新机制更友好和利于理解. EOSC在基于EOSIO的链中最早实践了去中心化的“软分叉”更新过程, 这是EOSC得以不断进化以解决各类机制问题的基本保障.

在另一方面, 基于多签设置链属性的功能可以为社区提供一套去中心化的链配置上链方案, 各种参数和配置可以根据实际发展来进行去中心化的修改, 使得社区更好的发展.

### 节点心跳机制与稳定的出块间隔

为了促进主网的稳定性, EOSC从经济模型的角度加强了备选节点的建设, 同时, EOSC添加了链上的节点心跳机制, 以此促进节点加强提高其稳定性, 促进整个主网更加稳定.

在心跳机制的基础之上, EOSC可以确认节点的运行情况, 使得基于链上对故障节点进行惩罚, 以此进一步督促节点的建设, 防止节点不作为导致整个主网的不稳定.

在启动之初便提高出块间隔时间, 以此避免在当前网络基础设施还未完善的情况下, 主网出现偶尔的软分叉, EOSIO设计的半秒钟的出块间隔和一个节点连出六个块的机制固然可以在未来提高链的可用性, 但是当前网络环境下还不适用, 本着务实的态度先行提高出块间隔时间, 未来条件成熟之后再改为快速的出块, 这样可以有效的减少软分叉, 同时区块数量减少可以大幅提高全节点同步速率, 使得可以有更多的全节点, 以此加强整个网络的可用性.

### 更多的合约层API

## 治理

### 投票分红

如果不给投票用户分红，普通用户的投票意愿就会降低，这会导致全链币的投票比例降低，那么几个大户联合就可能操纵投票影响选举，从而进行分叉攻击。所以，我们鼓励超级节点给投票的用户进行分红，充分活跃普通用户的投票参与度。

EOS Force 每年大约有 9000 万 EOS 奖励，超级节点可以自行设置自己的佣金比例，比如 1%。那么节点当选并出块后，可以拿走每个块奖励的 1%，剩余 99% 会进入每个节点的奖励池。节点根据每个用户的投票金额和时间得出用户“票龄”，再根据节点所有用户的“总票龄”，计算出每个用户在奖励池中的分红占比，给节点投票的用户随时可以从奖励池中提取分红。

如果 EOS Force 全网只有 3 亿的 EOS 参与投票，那么所有这些投票用户将平分 9000 万 EOS 的奖励，年化利率约为 0.9亿/3亿，也就是 30%。用户的年化利率随着投票参与率的升高而降低。随着币总量的上升，每年的奖励比例也会逐年下降。

为了减少自动分发消耗大量运算资源，EOS Force 的投票分红需要用户手动领取，领取快慢并不影响分红数量，所提取分红会立即变成可用余额。

用户每次提取分红后，在节点中的“票龄”会归零重新累计。

### 一票一投

EOS Force 实行一票一投的用户投票机制，1 个 EOS 只能投给某一个节点，但是一个用户可以给多个节点分别投不同数量的币。

假设一个用户有 1000 个 EOS，节点 A 的佣金比例是 1%，用户投给 A 300 个 EOS，节点 B 的佣金比例是 1.5%，用户投给 B 100 个 EOS，那么该用户的可用余额还剩 600 个 EOS，用户最终可以从这两个节点分别获得相应的投票分红。

EOS Force 支持用户调整投票数量，即增加或减少投票。如果增加投票，则自动进行一次分红领取，并扣除可用余额。如果减少投票，也会自动进行一次分红领取，同时减少的币量会有 3 天的冻结时间，3 天后，用户需要手动进行“解除冻结”操作，才能把投票金额变为可用余额。

### 23 个超级节点

在 BFT 算法中，节点数天然不适合是 3 的整数倍。如果是 21 个节点，且恰好形成了 14 票同意，7 票反对的局面，则既无法达成大于 2/3 的通过，也无法达成大于 1/3 的否决，治理陷入僵局。如果是 23 个节点，不是 3 的整数倍，那么最终会形成 15 票同意，8 票反对的否决决定，或者 16 票同意，7 票反对的通过决定，不会形成僵局。

### 紧急状态

EOS 链还不能完全确认稳定性，如果链出现没有预料到的 BUG，那么需要有可以设置紧急状态的功能，使链进入超级节点治理状态。一旦进入紧急状态，立即停止转账、投票、分红等可能影响用户资产安全的操作，只允许节点治理相关的操作。只有注册节点可以开启和关闭紧急状态，如果在职 23 个节点中有 16 个节点同意开启，则紧急状态启动。问题处理后，超级节点可以选择关闭紧急状态，当关闭紧急状态的节点数大于 8 时，恢复链的全部功能。

## 启动

- 启动阶段追求链的稳定性。在此阶段，只有用户转账、投票、分红的系统合约，用户不能自主部署新合约。

- 基础功能稳定后，开放合约部署功能，开发者可以开发 DAPP。

- 网络稳定后，各超级节点也完成了前期训练，恢复 0.5s 的出块速度。

EOS Force 创世块中默认会有 23 个引导节点，链启动后超级节点即可注册参与出块。

## 结束语

安全稳定是区块链的首要追求，EOS Force 将与社区一起为实现这一目标而不断努力！

## 致谢

- [EOSIO](https://github.com/EOSIO/eos)